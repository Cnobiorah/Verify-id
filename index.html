<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Virtual ID Verification â€“ Africa GBC 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* your original CSS â€” unchanged */
    :root {
      --primary: #0a59b0;
      --primary-soft: #e5f0ff;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --danger: #dc2626;
      --success: #16a34a;
      --card-radius: 18px;
      --shadow-soft: 0 22px 50px rgba(15, 23, 42, 0.20);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e5f0ff 0, #f9fafb 35%, #e5f0ff 100%);
      color: var(--text-main);
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: #ffffff;
      border-radius: var(--card-radius);
      box-shadow: var(--shadow-soft);
      padding: 26px 26px 24px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(10, 89, 176, 0.11), transparent 55%);
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header { display: flex; align-items: center; gap: 14px; margin-bottom: 10px; }

    .logo-circle {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: var(--primary-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .logo-circle img { width: 100%; height: 100%; object-fit: cover; }

    .brand-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .brand-subtitle { font-size: 13px; color: var(--text-muted); }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 11px;
      border-radius: 999px;
      background: var(--primary-soft);
      font-size: 11px;
      color: var(--primary);
      margin: 8px 0 14px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--primary);
    }

    h2 { margin: 6px 0 6px; font-size: 22px; }

    .helper {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 18px;
      max-width: 420px;
    }

    label { font-size: 13px; font-weight: 500; margin-bottom: 6px; display: block; }

    input {
      width: 100%;
      padding: 11px 12px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease;
    }

    input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(10, 89, 176, 0.30);
    }

    .hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

    button {
      width: 100%;
      margin-top: 18px;
      padding: 12px 12px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 500;
      background: var(--primary);
      color: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.28);
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.30);
      background: #084a93;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.24);
    }

    button:disabled {
      opacity: 0.7;
      transform: none;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.22);
      cursor: default;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      border-top-color: rgba(255, 255, 255, 0.4);
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .status { margin-top: 10px; font-size: 13px; display: none; }
    .status-success { color: var(--success); }
    .status-error { color: var(--danger); }

    .details-card {
      margin-top: 14px;
      padding: 11px 12px;
      border-radius: 12px;
      background: #f1f5f9;
      font-size: 13px;
      display: none;
    }

    .details-row { margin-bottom: 4px; }
    .details-label { font-weight: 600; }

    .meeting-card {
      margin-top: 13px;
      padding: 11px 12px;
      border-radius: 12px;
      background: #e5f0ff;
      font-size: 13px;
      display: none;
    }

    .meeting-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      font-size: 13px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }
    .meeting-link:hover { text-decoration: underline; }

    .footnote {
      margin-top: 14px;
      font-size: 11px;
      color: var(--text-muted);
    }

    /* LOGOUT BUTTON STYLE */
    #logoutBtn {
      width: 100%;
      margin-top: 16px;
      padding: 10px 14px;
      border-radius: 10px;
      background: #374151;
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: none;
    }
    #logoutBtn:hover {
      background: #1f2937;
    }

  </style>
</head>
<body>

  <div class="card">
    <div class="card-inner">

      <!-- header, branding, input, etc â€” unchanged -->

      <div class="card-header">
        <div class="logo-circle">
          <img src="cgrc-logo.png" alt="Cadright Global Resources Logo">
        </div>
        <div>
          <div class="brand-title">CADRIGHT GLOBAL RESEARCH CELL</div>
          <div class="brand-subtitle">Africa-Wide Green Building Challenge 2026</div>
        </div>
      </div>

      <div class="badge">
        <span class="badge-dot"></span>
        Secure Virtual ID Checkpoint
      </div>

      <h2>Verify Your Virtual ID</h2>
      <p class="helper">
        Enter the Virtual ID sent to your email after registration. Once verified, youâ€™ll see your
        participant details and the link to join the virtual briefing.
      </p>

      <label for="virtualID">Virtual ID</label>
      <input id="virtualID" placeholder="e.g. GBC26-0001-EA3D" autocomplete="off" />

      <div class="hint">
        Use the exact ID format from your confirmation email. Virtual IDs are unique per participant.
      </div>

      <button id="verifyBtn" onclick="verifyID()">
        <span id="btnText">Verify ID</span>
        <span id="btnSpinner" class="spinner" style="display:none;"></span>
      </button>

      <div id="statusSuccess" class="status status-success">ID verified successfully.</div>
      <div id="statusError" class="status status-error">Invalid Virtual ID. Please try again.</div>

      <div id="detailsCard" class="details-card">
        <div class="details-row"><span class="details-label">Name:</span> <span id="detailName"></span></div>
        <div class="details-row"><span class="details-label">Country:</span> <span id="detailCountry"></span></div>
        <div class="details-row"><span class="details-label">Institution:</span> <span id="detailInstitution"></span></div>
        <div class="details-row"><span class="details-label">Track:</span> <span id="detailTrack"></span></div>
        <div class="details-row"><span class="details-label">Discipline:</span> <span id="detailDiscipline"></span></div>
      </div>

      <div id="meetingCard" class="meeting-card">
        <div>This meeting link is for verified participants only. Please do not share it publicly.</div>
        <a class="meeting-link"
           href="YOUR_MEETING_LINK_HERE"
           target="_blank"
           rel="noopener"
           onclick="logJoin()">
          ðŸ‘‰ Join the virtual meeting
        </a>
      </div>

      <!-- LOGOUT BUTTON ADDED -->
      <button id="logoutBtn" onclick="logoutUser()">Logout</button>

      <div class="footnote">
        If you believe your Virtual ID is not working, please contact the competition secretariat with
        your full name, email, and institution.
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const client = supabase.createClient(
      "https://ktyyqxypzxxsdreroqrc.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eXlxeHlwenh4c2RyZXJvcXJjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNTUyNDUsImV4cCI6MjA3OTgzMTI0NX0.mdXN48eOc8ixaqdm30suROdEzB7BfhqZikpAK49fxCc"
    );

    let lastVerifiedID = null;

    async function logVerification(virtualId, eventType, success) {
      try {
        await client
          .from("verification_logs")
          .insert({
            virtual_id: virtualId,
            event_type: eventType,
            success: success,
            user_agent: navigator.userAgent || null
          });
      } catch (err) {
        console.error("Log insert failed:", err);
      }
    }

    async function verifyID() {
      const idInput = document.getElementById("virtualID");
      const id = idInput.value.trim();

      const statusSuccess = document.getElementById("statusSuccess");
      const statusError = document.getElementById("statusError");
      const detailsCard = document.getElementById("detailsCard");
      const meetingCard = document.getElementById("meetingCard");
      const logoutBtn = document.getElementById("logoutBtn");

      const detailName = document.getElementById("detailName");
      const detailCountry = document.getElementById("detailCountry");
      const detailInstitution = document.getElementById("detailInstitution");
      const detailTrack = document.getElementById("detailTrack");
      const detailDiscipline = document.getElementById("detailDiscipline");

      const btn = document.getElementById("verifyBtn");
      const btnText = document.getElementById("btnText");
      const btnSpinner = document.getElementById("btnSpinner");

      statusSuccess.style.display = "none";
      statusError.style.display = "none";
      detailsCard.style.display = "none";
      meetingCard.style.display = "none";
      logoutBtn.style.display = "none";

      if (!id) {
        statusError.textContent = "Please enter your Virtual ID.";
        statusError.style.display = "block";
        idInput.focus();
        return;
      }

      btn.disabled = true;
      btnText.style.display = "none";
      btnSpinner.style.display = "inline-block";

      const { data, error } = await client
        .from("competition_participants")
        .select("full_name, country, institution, track, discipline")
        .eq("virtual_id", id)
        .maybeSingle();

      btn.disabled = false;
      btnText.style.display = "inline";
      btnSpinner.style.display = "none";

      if (error) {
        console.error(error);
        statusError.textContent = "Something went wrong. Please try again.";
        statusError.style.display = "block";
        await logVerification(id, "verify", false);
        return;
      }

      if (!data) {
        statusError.textContent = "Invalid Virtual ID. Please try again.";
        statusError.style.display = "block";
        await logVerification(id, "verify", false);
        return;
      }

      detailName.textContent = data.full_name || "â€”";
      detailCountry.textContent = data.country || "â€”";
      detailInstitution.textContent = data.institution || "â€”";
      detailTrack.textContent = data.track || "â€”";
      detailDiscipline.textContent = data.discipline || "â€”";

      detailsCard.style.display = "block";
      meetingCard.style.display = "block";
      statusSuccess.style.display = "block";
      logoutBtn.style.display = "block";

      lastVerifiedID = id;
      await logVerification(id, "verify", true);
    }

    async function logJoin() {
      if (!lastVerifiedID) return;
      await logVerification(lastVerifiedID, "join", true);
    }

    // LOGOUT FUNCTION ADDED
    function logoutUser() {
      document.getElementById("virtualID").value = "";
      document.getElementById("detailsCard").style.display = "none";
      document.getElementById("meetingCard").style.display = "none";
      document.getElementById("statusSuccess").style.display = "none";
      document.getElementById("statusError").style.display = "none";
      document.getElementById("logoutBtn").style.display = "none";
      lastVerifiedID = null;
    }
  </script>
</body>
</html>
